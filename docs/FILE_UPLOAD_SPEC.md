# 文件上传功能详细说明

## 1. 功能概述

文件上传功能是Readout-10min-App的核心功能之一，允许用户上传文本文件（PDF、Word、TXT）到系统中，系统会自动解析文本内容并拆分段落，供用户在移动端进行朗读练习。

## 2. 功能详细说明

### 2.1 上传方式

#### 2.1.1 拖拽上传
- 用户可以直接将文件拖拽到上传区域完成上传
- 支持多文件同时拖拽上传
- 拖拽时显示视觉反馈（边框变色、阴影效果）

#### 2.1.2 点击上传
- 用户可以点击上传区域，通过文件选择对话框选择文件
- 支持多文件选择

### 2.2 支持的文件格式

- PDF (.pdf)
- Word文档 (.docx)
- 纯文本文件 (.txt)

### 2.3 文件大小限制

- 单个文件最大限制：10MB
- 支持多文件同时上传，总大小不超过50MB

### 2.4 上传流程

1. 用户选择或拖拽文件到上传区域
2. 系统验证文件类型和大小
3. 显示上传进度条
4. 文件上传到Supabase Storage
5. 触发文本解析云函数
6. 解析结果存储到Supabase PostgreSQL
7. 更新文件列表显示

### 2.5 文件管理

#### 2.5.1 文件列表
- 显示已上传的文件列表
- 包含文件名、上传时间、文件大小、状态等信息

#### 2.5.2 文件操作
- **预览**：点击文件可预览内容
- **删除**：点击删除按钮可删除文件
- **查看详情**：点击文件可查看详细信息，包括段落数、总时长等

### 2.6 视觉设计

- 采用粉色系配色方案（主色调#ff8ba7）
- 卡片式布局
- 平滑的过渡动画
- 响应式设计，适配不同屏幕尺寸

## 3. 接口设计

### 3.1 前端API

#### 3.1.1 文件上传接口

| 接口名称 | URL | 方法 | 功能描述 | 请求参数 | 成功响应 | 失败响应 |
|---------|-----|------|---------|----------|----------|----------|
| 文件上传 | /storage/v1/object | POST | 上传文件到Supabase Storage | bucket: string<br>path: string<br>file: File | `{"Key": "文件路径"}` | `{"error": "错误信息"}` |

#### 3.1.2 文件列表接口

| 接口名称 | URL | 方法 | 功能描述 | 请求参数 | 成功响应 | 失败响应 |
|---------|-----|------|---------|----------|----------|----------|
| 文件列表 | /rest/v1/content | GET | 获取已上传的文件列表 | - | `[{"id": "文件ID", "name": "文件名", "size": "文件大小", "upload_time": "上传时间", "status": "状态"}]` | `{"error": "错误信息"}` |

#### 3.1.3 文件删除接口

| 接口名称 | URL | 方法 | 功能描述 | 请求参数 | 成功响应 | 失败响应 |
|---------|-----|------|---------|----------|----------|----------|
| 文件删除 | /storage/v1/object | DELETE | 从Supabase Storage删除文件 | bucket: string<br>path: string | `{"success": true}` | `{"error": "错误信息"}` |

### 3.2 后端API

#### 3.2.1 文本解析接口

| 接口名称 | URL | 方法 | 功能描述 | 请求参数 | 成功响应 | 失败响应 |
|---------|-----|------|---------|----------|----------|----------|
| 文本解析 | /api/parse-text | POST | 解析上传的文本文件 | file_path: string | `{"paragraphs": ["段落1", "段落2", ...]}` | `{"error": "错误信息"}` |

#### 3.2.2 段落拆分接口

| 接口名称 | URL | 方法 | 功能描述 | 请求参数 | 成功响应 | 失败响应 |
|---------|-----|------|---------|----------|----------|----------|
| 段落拆分 | /api/split-paragraphs | POST | 智能拆分文本段落 | text: string | `{"paragraphs": ["段落1", "段落2", ...]}` | `{"error": "错误信息"}` |

## 4. 技术实现

### 4.1 前端实现

- 使用React + TypeScript开发
- 使用Ant Design组件库
- 使用Supabase JavaScript SDK与Supabase Storage交互

### 4.2 后端实现

- 使用Supabase Storage存储文件
- 使用Vercel Edge Functions实现文本解析
- 使用Supabase PostgreSQL存储解析结果
- 使用Supabase自动生成的REST API提供文件管理功能

### 4.3 数据流

1. 用户上传文件 → 前端验证 → Supabase Storage存储
2. 触发文本解析云函数 → 解析文本 → 拆分段落
3. 解析结果存储到Supabase PostgreSQL → 更新文件状态
4. 前端获取文件列表 → 显示已上传文件

## 5. 测试场景

### 5.1 功能测试

#### 5.1.1 正常上传流程测试
- **测试步骤**：
  1. 打开文件上传页面
  2. 点击上传区域，选择一个PDF文件
  3. 等待上传完成
  4. 检查文件列表是否显示已上传的文件
- **预期结果**：文件上传成功，文件列表显示该文件，状态为"已完成"

#### 5.1.2 拖拽上传测试
- **测试步骤**：
  1. 打开文件上传页面
  2. 从本地文件系统拖拽一个Word文件到上传区域
  3. 等待上传完成
  4. 检查文件列表是否显示已上传的文件
- **预期结果**：文件上传成功，文件列表显示该文件，状态为"已完成"

#### 5.1.3 多文件同时上传测试
- **测试步骤**：
  1. 打开文件上传页面
  2. 选择多个文件（PDF、Word、TXT各一个）
  3. 等待所有文件上传完成
  4. 检查文件列表是否显示所有已上传的文件
- **预期结果**：所有文件上传成功，文件列表显示所有文件，状态均为"已完成"

#### 5.1.4 文件删除测试
- **测试步骤**：
  1. 打开文件上传页面
  2. 上传一个文件
  3. 等待上传完成
  4. 点击该文件的删除按钮
  5. 确认删除操作
  6. 检查文件列表是否不再显示该文件
- **预期结果**：文件删除成功，文件列表不再显示该文件

### 5.2 边界测试

#### 5.2.1 大文件上传测试
- **测试步骤**：
  1. 打开文件上传页面
  2. 选择一个接近10MB的PDF文件
  3. 等待上传完成
  4. 检查文件列表是否显示已上传的文件
- **预期结果**：文件上传成功，文件列表显示该文件，状态为"已完成"

#### 5.2.2 不支持的文件类型上传测试
- **测试步骤**：
  1. 打开文件上传页面
  2. 选择一个图片文件（.jpg）
  3. 观察系统反馈
- **预期结果**：系统显示错误提示，提示不支持的文件类型

#### 5.2.3 文件大小超限测试
- **测试步骤**：
  1. 打开文件上传页面
  2. 选择一个超过10MB的文件
  3. 观察系统反馈
- **预期结果**：系统显示错误提示，提示文件大小超过限制

### 5.3 异常测试

#### 5.3.1 网络异常测试
- **测试步骤**：
  1. 打开文件上传页面
  2. 开始上传一个较大的文件
  3. 在上传过程中断开网络连接
  4. 观察系统反馈
  5. 重新连接网络
  6. 观察系统是否自动恢复上传
- **预期结果**：网络中断时系统显示错误提示，网络恢复后系统尝试重新上传

#### 5.3.2 服务器异常测试
- **测试步骤**：
  1. 模拟服务器暂时不可用的情况
  2. 尝试上传文件
  3. 观察系统反馈
- **预期结果**：系统显示错误提示，提示服务器暂时不可用

### 5.4 性能测试

#### 5.4.1 上传速度测试
- **测试步骤**：
  1. 在不同网络环境下（Wi-Fi、4G、3G）
  2. 上传相同大小的文件
  3. 记录上传所需时间
- **预期结果**：上传速度与网络环境匹配，系统能够适应不同的网络速度

#### 5.4.2 多文件并发上传测试
- **测试步骤**：
  1. 同时上传5个中等大小的文件
  2. 观察系统性能和上传进度显示
- **预期结果**：系统能够稳定处理多文件并发上传，上传进度显示准确

## 6. 界面设计

### 6.1 上传区域

- **布局**：卡片式布局，居中显示
- **尺寸**：宽度100%，最小高度80px
- **样式**：
  - 背景色：#faeee7
  - 边框：2px dashed #ffc6c7
  - 圆角：0.75rem
  - 阴影：var(--shadow-sm)
- **内容**：
  - 上传图标：📁
  - 标题："点击或拖拽文件到此处上传"
  - 支持的文件类型提示："支持 PDF、Word、TXT 格式"
  - 文件大小限制提示："单个文件不超过10MB"

### 6.2 上传进度

- **布局**：居中显示，位于上传区域下方
- **样式**：
  - 背景：rgba(255, 255, 255, 0.5)
  - 圆角：0.5rem
  - 内边距：1rem
- **内容**：
  - 进度条：高度6px，背景rgba(0, 0, 0, 0.08)，进度填充使用渐变色
  - 进度文本：显示当前上传进度百分比

### 6.3 文件列表

- **布局**：卡片式布局，位于上传区域下方
- **样式**：
  - 背景色：#faeee7
  - 边框：1px solid #ffc6c7
  - 圆角：0.75rem
  - 阴影：var(--shadow-sm)
- **内容**：
  - 文件名
  - 文件大小
  - 上传时间
  - 状态（上传中、已完成、失败）
  - 操作按钮（预览、删除）

## 7. 实现注意事项

### 7.1 前端实现注意事项

1. **文件验证**：在上传前验证文件类型和大小，避免无效文件上传到服务器
2. **进度显示**：实现准确的上传进度显示，提升用户体验
3. **错误处理**：妥善处理各种错误情况，提供清晰的错误提示
4. **响应式设计**：确保在不同屏幕尺寸下都能正常显示和操作
5. **性能优化**：
   - 大文件上传时使用分片上传
   - 多文件上传时使用并发控制，避免同时上传过多文件

### 7.2 后端实现注意事项

1. **文件存储**：合理组织Supabase Storage的文件存储结构，便于管理
2. **文本解析**：处理不同格式文件的解析，确保文本提取准确
3. **段落拆分**：实现智能段落拆分算法，根据词数和平均语速自动拆分
4. **安全性**：
   - 验证上传文件的合法性，防止恶意文件
   - 实现文件访问控制，确保用户只能访问自己的文件
5. **性能优化**：
   - 优化文本解析速度
   - 实现缓存机制，避免重复解析相同文件

### 7.3 测试注意事项

1. **测试覆盖**：确保测试覆盖所有功能点和边界情况
2. **测试环境**：在不同网络环境和设备上进行测试
3. **测试数据**：准备各种类型和大小的测试文件
4. **测试工具**：使用合适的测试工具进行自动化测试

## 8. 总结

文件上传功能是Readout-10min-App的重要组成部分，通过本详细说明文档，明确了功能需求、接口设计和测试场景，为开发和测试提供了清晰的指导。实现此功能时，应注重用户体验、系统性能和安全性，确保用户能够方便、快捷地上传文件并进行朗读练习。